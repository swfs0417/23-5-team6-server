#!/bin/bash
# pre-commit hook: 커밋 전 alembic 다중 헤드 체크
# 설치: cp scripts/pre-commit-alembic .git/hooks/pre-commit && chmod +x .git/hooks/pre-commit

# 마이그레이션 파일이 변경되었는지 확인
MIGRATION_FILES=$(git diff --cached --name-only | grep "alembic/versions/" || true)

if [ -n "$MIGRATION_FILES" ]; then
    echo "🔍 마이그레이션 파일 변경 감지, 헤드 체크 중..."
    
    HEAD_COUNT=$(alembic heads 2>/dev/null | wc -l)
    
    if [ "$HEAD_COUNT" -gt 1 ]; then
        echo "❌ 다중 마이그레이션 헤드 감지!"
        echo "커밋 전에 'alembic merge heads'로 해결하세요."
        exit 1
    fi
    
    echo "✅ 마이그레이션 헤드 체크 통과"
fi

exit 0
